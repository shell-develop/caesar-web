(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c9f7156"],{"0023":function(t,e,n){},"0462":function(t,e,n){"use strict";var s=n("634f"),a=n.n(s);a.a},"11a2":function(t,e,n){"use strict";function s(t){switch(t){case!0:return"success";case!1:return"warning";case 1:return"success";case 0:return"warning";default:return"info"}}function a(t){switch(t){case!0:return"有效";case!1:return"无效";case 1:return"有效";case 0:return"无效";default:return"未定义"}}n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return a}))},"14a3":function(t,e){t.exports="##### Jumpserver安装说明\n+ 建议使用全新安装的`jumpserver1.5.6`版本\n+ 安装文档参考官方说明https://jumpserver.readthedocs.io/zh/master/step_by_step.html\n+ 经本人测试jumpserver不支持Mysql8.0, 建议用Mysql5.6/5.7\n\n##### Jumpserver配置说明\n+ `资产管理` - `管理用户` 中配置管理用户（root）\n+ `资产管理` - `系统用户` 中配置系统用户（登录服务器的账户）\n+ 不要删除根节点(Default)\n\n##### Opscloud自动化配置\n+ oc中新增服务器会自动创建jumpserver资产\n+ 资产和资产组都会同步映射\n+ 用户授权了服务器组则会自动同步用户到jumpserver,并映射资产授权\n+ 用户在oc个人详情中保存pubkey会自动同步到jumpserver\n\n##### 使用问题\n+ koko名称不正确（请修改terminal表中name字段值），koko注册名称不正确导致"},"3a3b":function(t,e,n){"use strict";var s=n("0023"),a=n.n(s);a.a},"634f":function(t,e,n){},"95ff":function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{attrs:{title:t.title,visible:t.formStatus.visible,width:"80%","before-close":t.handlerCloseDialog},on:{"update:visible":function(e){return t.$set(t.formStatus,"visible",e)}}},[t._l(t.xterms,(function(e){return n("div",{key:e},[[n("el-col",{attrs:{span:24}},[n("el-card",{staticStyle:{"margin-right":"10px","margin-bottom":"10px"},attrs:{shadow:"hover","body-style":"padding: 2px"}},[n("div",{staticClass:"clearfix",staticStyle:{height:"15px"},attrs:{slot:"header"},slot:"header"},[n("span",[n("el-tag",[t._v(" "+t._s(e))])],1),n("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"退出",placement:"top-start"}},[n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(n){return t.handlerLogout(e)}}},[t._v(" Logout ")])],1),n("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"复制会话",placement:"top-start"}},[n("el-button",{staticStyle:{float:"right",padding:"3px 0","margin-right":"20px"},attrs:{type:"text"},on:{click:function(e){return t.handlerDuplicateSession()}}},[t._v("Duplicate ")])],1)],1),n("div",{staticClass:"xterm",attrs:{id:e}})])],1)]],2)})),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"mini"},on:{click:t.handlerExit}},[t._v("关闭")])],1)],2)},a=[],r=(n("4de4"),n("d81d"),n("b0c0"),n("1276"),n("c276")),i=(n("abb2"),n("fcf3")),o=n("47d0"),l=n("e232"),c="ws/xterm",u="XTERM",d={data:function(){return{title:"Web-XTerminal",socketURI:"",server:{},addonMap:[],xterms:[],xtermMap:{},timer:null,xtermSize:{rows:30},xtermTheme:{foreground:"#FFFFFF",background:"#606266",cursor:"help"}}},name:"XTerm",props:["formStatus"],mixins:[],mounted:function(){this.setXTermSetting(),this.initWebSocketURL()},beforeDestroy:function(){try{for(var t in this.socket.close(),this.xtermMap)this.xtermMap[t].dispose()}catch(e){}clearInterval(this.timer)},methods:{setXTermSetting:function(){var t=this;Object(l["a"])(u).then((function(e){if(e.success)try{t.xtermTheme.foreground=e.body["XTERM_FOREGROUND"],t.xtermTheme.background=e.body["XTERM_BACKGROUND"],t.xtermSize.rows=e.body["XTERM_ROWS"]||30}catch(n){}else t.$message.error(e.msg)}))},handlerExit:function(){this.handlerClose();try{for(var t in this.socket.close(),this.xtermMap)this.xtermMap[t].dispose()}catch(e){}this.formStatus.visible=!1},initData:function(t){this.server=t,this.handlerLogin()},initWebSocketURL:function(){var t=window.location.host,e=window.location.href.split("://")[0],n=("http"===e?"ws":"wss")+"://"+t+"/cs/"+c;this.socketURI=n},setTimer:function(){var t=this;this.timer=setInterval((function(){t.handlerSSHHeartbeat()}),1e4)},handlerSSHHeartbeat:function(){var t={status:"HEARTBEAT"};try{this.socketOnSend(JSON.stringify(t))}catch(e){}},initTermInstance:function(t){var e=this,n=t.name,s=new i["Terminal"]({rendererType:"canvas",allowTransparency:!0,fontSize:11,rows:this.xtermSize.rows,theme:this.xtermTheme,termName:"xterm",visualBell:!1,popOnBell:!1,scrollback:1e3,screenKeys:!1,debug:!1,cancelEvents:!1,cursorStyle:"underline",cursorBlink:!0,convertEol:!0});e.addonMap[n]=new o["FitAddon"],s.loadAddon(e.addonMap[n]),s.open(document.getElementById(n)),e.addonMap[n].fit(),s.focus(),s.onData((function(t){var s={data:t,status:"COMMAND",instanceId:n};e.socketOnSend(JSON.stringify(s))})),this.xtermMap[n]=s},handlerResize:function(){for(var t in this.xtermMap){this.addonMap[t].fit();var e={status:"RESIZE",instanceId:t,xtermWidth:7*this.addonMap[t]._terminal.cols,xtermHeight:document.getElementById(t).clientHeight};this.socketOnSend(JSON.stringify(e)),this.xtermMap[t].scrollToBottom()}},handlerDuplicateSession:function(){var t=this,e=this.server.name+"#"+r["a"].uuid(),n={status:"DUPLICATE_SESSION_IP",duplicateInstanceId:this.server.name,token:r["a"].cookies.get("token"),instanceId:e,xtermWidth:7*this.addonMap[e.split("#")[0]]._terminal.cols,xtermHeight:document.getElementById(e.split("#")[0]).clientHeight};this.xterms.push(e);var s={name:e,ip:this.server.privateIp};this.$nextTick((function(){t.initTermInstance(s),t.socketOnSend(JSON.stringify(n))}))},handlerLogout:function(t){var e={status:"LOGOUT",instanceId:t};this.socketOnSend(JSON.stringify(e));var n=this.xtermMap[t];n.dispose(),delete this.xtermMap[t],this.xterms=this.xterms.filter((function(e){return e!==t})),this.$message.warning(t+"终端已关闭")},handlerClose:function(){var t={status:"CLOSE"};this.socketOnSend(JSON.stringify(t)),this.xterms=[],this.xtermMap={},clearInterval(this.timer)},handlerCloseDialog:function(t){var e=this;this.$confirm("确定退出Web终端,并关闭所有会话?").then((function(n){t(),e.handlerExit()})).catch((function(t){}))},handlerLogin:function(){this.xtermMap={},this.initSocket(),this.setTimer()},initSocket:function(){this.socket=new WebSocket(this.socketURI),this.socketOnClose(),this.socketOnOpen(),this.socketOnError(),this.socketOnMessage()},socketOnOpen:function(){var t=this;this.socket.onopen=function(){try{t.xterms=[],t.xterms.push(t.server.name),t.$nextTick((function(){t.initTermInstance(t.server);var e={token:r["a"].cookies.get("token"),instanceId:t.server.name,ip:t.server.privateIp,status:"INITIAL_IP",xtermWidth:0,xtermHeight:308};t.socketOnSend(JSON.stringify(e)),t.$nextTick((function(){t.handlerResize()}))}))}catch(e){t.$message.error("登录失败，未选择服务器或其它原因")}}},socketOnClose:function(){this.socket.onclose=function(){}},socketOnError:function(){this.socket.onerror=function(){}},socketOnSend:function(t){this.socket.send(t)},socketOnMessage:function(){var t=this;this.socket.onmessage=function(e){var n=JSON.parse(e.data),s=t;n.map((function(t){s.xtermMap[t.instanceId].write(t.output)}))}}}},m=d,p=(n("0462"),n("2877")),h=function(t){t.options.__source="src/components/opscloud/xterm/XTerm.vue"},g=h,f=Object(p["a"])(m,s,a,!1,null,null,null);"function"===typeof g&&g(f);e["a"]=f.exports},9960:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("d2-container",[[n("div",[n("h1",[t._v(t._s(t.title))])]),n("el-col",[n("el-tabs",{staticStyle:{height:"200px"},attrs:{"tab-position":"top"}},[n("el-tab-pane",{attrs:{label:"设置面板"}},[n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:10}},[n("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[t._v("全局设置")]),n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:t.saveSettings}},[t._v("保存")])],1),n("el-form",{attrs:{model:t.settings}},[n("el-tooltip",{attrs:{content:"推送权限的账户",placement:"top-start",effect:"light"}},[n("el-form-item",{attrs:{label:"管理账户","label-width":t.labelWidth,required:!0}},[[n("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:t.settings.assetsAdminuserId,callback:function(e){t.$set(t.settings,"assetsAdminuserId","string"===typeof e?e.trim():e)},expression:"settings.assetsAdminuserId"}},t._l(t.settings.assetsAdminusers,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)]],2)],1),n("el-tooltip",{attrs:{content:"普通用户登录系统的账户(不支持sudo)",placement:"top-start",effect:"light"}},[n("el-form-item",{attrs:{label:"低权限系统账户","label-width":t.labelWidth,required:!0}},[[n("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:t.settings.assetsSystemuserId,callback:function(e){t.$set(t.settings,"assetsSystemuserId","string"===typeof e?e.trim():e)},expression:"settings.assetsSystemuserId"}},t._l(t.settings.assetsSystemusers,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)]],2)],1),n("el-tooltip",{attrs:{content:"管理员登录系统的账户(支持sudo)",placement:"bottom",effect:"light"}},[n("el-form-item",{attrs:{label:"高权限系统账户","label-width":t.labelWidth,required:!0}},[[n("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:t.settings.assetsAdminSystemuserId,callback:function(e){t.$set(t.settings,"assetsAdminSystemuserId","string"===typeof e?e.trim():e)},expression:"settings.assetsAdminSystemuserId"}},t._l(t.settings.assetsSystemusers,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)]],2)],1)],1)],1),n("div",{staticStyle:{margin:"15px 0"}}),n("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[t._v("管理员")])]),n("div",{staticStyle:{"margin-bottom":"5px"}},[n("el-row",{staticStyle:{"margin-bottom":"5px"}},[n("el-select",{style:t.searchBarHeadStyle,attrs:{filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"搜索用户","remote-method":t.getUser,loading:t.searchUserLoading},model:{value:t.userId,callback:function(e){t.userId=e},expression:"userId"}},t._l(t.userOptions,(function(t){return n("el-option",{key:t.id,attrs:{label:t.username,value:t.id}})})),1),n("el-button",{style:t.searchBarStyle,attrs:{type:"success",plain:"",size:"mini",disabled:""==t.userId},on:{click:function(e){return t.setUserAdmin()}}},[t._v("授权 ")])],1)],1),n("el-row",{staticStyle:{"margin-bottom":"5px"}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.adminUserLoading,expression:"adminUserLoading"}],staticStyle:{width:"100%"},attrs:{data:t.adminUserTableData}},[n("el-table-column",{attrs:{prop:"username",label:"用户名"}}),n("el-table-column",{attrs:{prop:"name",label:"显示名"}}),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return["admin"!=e.row.username?n("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(n){return t.revokeItem(e.row)}}},[t._v("撤销 ")]):t._e()]}}])})],1),n("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.adminUserPagination.total,"current-page":t.adminUserPagination.currentPage,"page-size":t.adminUserPagination.pageSize},on:{"current-change":t.adminUserPaginationCurrentChange}})],1)],1)],1),n("el-col",{attrs:{span:14}},[n("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[t._v("终端(koko)")]),n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:t.getTerminal}},[t._v("刷新")])],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.terminalLoding,expression:"terminalLoding"}],staticStyle:{width:"100%"},attrs:{data:t.terminals}},[n("el-table-column",{attrs:{prop:"name",label:"名称"}}),n("el-table-column",{attrs:{prop:"remoteAddr",label:"ip"}}),n("el-table-column",{attrs:{prop:"sshPort",label:"ssh"}}),n("el-table-column",{attrs:{prop:"httpPort",label:"http"}}),n("el-table-column",{attrs:{prop:"sessions",label:"会话"}}),n("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(n){return t.handlerXTerm(e.row)}}},[t._v("登录")])]}}])})],1)],1)],1)],1)],1),n("el-tab-pane",{attrs:{label:"当前会话"}},[n("div",{staticStyle:{"margin-bottom":"5px"}},[n("el-row",{staticStyle:{"margin-bottom":"5px"}},[n("el-button",{style:t.searchBarStyle,on:{click:t.fetchTerminalSessionData}},[t._v("查询")])],1)],1),n("el-row",{staticStyle:{"margin-bottom":"5px"}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.terminalSessionLoading,expression:"terminalSessionLoading"}],staticStyle:{width:"100%"},attrs:{data:t.terminalSessionTableData}},[n("el-table-column",{attrs:{prop:"user",label:"用户"}}),n("el-table-column",{attrs:{prop:"remoteAddr",label:"用户ip"}}),n("el-table-column",{attrs:{prop:"asset",label:"资产"}}),n("el-table-column",{attrs:{prop:"protocol",label:"协议"}}),n("el-table-column",{attrs:{prop:"systemUser",label:"系统账户"}}),n("el-table-column",{attrs:{prop:"terminalName",label:"终端名称"}}),n("el-table-column",{attrs:{prop:"dateStart",label:"会话开始时间"}})],1),n("el-pagination",{attrs:{background:"","page-sizes":[10,15,20,25,30],layout:"sizes, prev, pager, next",total:t.terminalSessionPagination.total,"current-page":t.terminalSessionPagination.currentPage,"page-size":t.terminalSessionPagination.pageSize},on:{"current-change":t.terminalSessionPaginationCurrentChange,"size-change":t.handleSizeChange}})],1)],1),n("el-tab-pane",{attrs:{label:"帮助"}},[n("d2-markdown",{attrs:{source:t.doc}})],1)],1)],1),n("XTerm",{ref:"xtermDialog",attrs:{formStatus:t.formXtermStatus}})]],2)},a=[],r=(n("a4d3"),n("4de4"),n("b0c0"),n("e439"),n("dbb4"),n("b64b"),n("159b"),n("ade3")),i=n("5880"),o=n("95ff"),l=n("14a3"),c=n.n(l),u=n("da4f"),d=n("11a2"),m=n("9f19"),p=n("9bd2");function h(){return Object(p["a"])({url:"/jump/jumpserver/settings/query",method:"get"})}function g(t){return Object(p["a"])({url:"/jump/jumpserver/settings/save",method:"post",data:t})}function f(){return Object(p["a"])({url:"/jump/jumpserver/terminal/query",method:"get"})}function b(t){return Object(p["a"])({url:"/jump/jumpserver/terminal/session/page/query",method:"post",data:t})}function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function S(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){Object(r["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var y={data:function(){return{formXtermStatus:{visible:!1},searchBarHeadStyle:{display:"inline-block",maxWidth:"200px"},searchBarStyle:{marginLeft:"5px"},adminUserTableData:[],adminUserLoading:!1,adminUserPagination:{currentPage:1,pageSize:10,total:0},queryAdminUserParam:{queryName:"",isAdmin:1},terminalSessionTableData:[],terminalSessionPagination:{currentPage:1,pageSize:10,total:0},terminalSessionLoading:!1,userOptions:[],userId:"",searchUserLoading:!1,labelWidth:"150px",settings:{},terminals:[],terminalLoding:!1,title:"Jumpserver控制面板",doc:c.a}},computed:S({},Object(i["mapState"])("d2admin/user",["info"])),mounted:function(){this.initPageSize(),this.getSettings(),this.getTerminal(),this.fetchAdminUserData(),this.fetchTerminalSessionData()},components:{XTerm:o["a"]},filters:{getUserRoleType:u["b"],getUserRoleText:u["a"],getActiveType:d["b"],getActiveText:d["a"]},methods:S({},Object(i["mapActions"])({setPageSize:"d2admin/user/set"}),{handleSizeChange:function(t){this.terminalSessionPagination.pageSize=t,this.info.pageSize=t,this.setPageSize(this.info),this.fetchTerminalSessionData()},initPageSize:function(){"undefined"!==typeof this.info.pageSize&&(this.terminalSessionPagination.pageSize=this.info.pageSize)},getUser:function(t){var e=this;this.searchUserLoading=!0;var n={queryName:t,isAdmin:0,page:1,length:20};Object(m["c"])(n).then((function(t){e.userOptions=t.body.data,e.searchUserLoading=!1}))},getSettings:function(){var t=this;h().then((function(e){t.settings=e.body}))},handlerXTerm:function(t){this.formXtermStatus.visible=!0;var e={name:t.name,privateIp:t.remoteAddr};this.$refs.xtermDialog.initData(e)},saveSettings:function(){var t=this;g(this.settings).then((function(e){e.success?(t.getSettings(),t.$message({type:"success",message:"设置成功!"})):t.$message({type:"warning",message:"设置失败!"})}))},setUserAdmin:function(){var t=this;Object(m["a"])(this.userId).then((function(e){e.success?(t.fetchAdminUserData(),t.$message({type:"success",message:"设置成功!"})):t.$message.error(e.msg),t.userId=""}))},revokeItem:function(t){var e=this;Object(m["e"])(t.id).then((function(t){t.success?(e.fetchAdminUserData(),e.$message({type:"success",message:"设置成功!"})):e.$message.error(t.msg)}))},getTerminal:function(){var t=this;this.terminalLoding=!0,f().then((function(e){t.terminals=e.body,t.terminalLoding=!1}))},adminUserPaginationCurrentChange:function(t){this.adminUserPagination.currentPage=t,this.fetchAdminUserData()},fetchAdminUserData:function(){var t=this;this.adminUserLoading=!0;var e=Object.assign({},this.queryAdminUserParam);e.page=this.adminUserPagination.currentPage,e.length=this.adminUserPagination.pageSize,Object(m["c"])(e).then((function(e){t.adminUserTableData=e.body.data,t.adminUserPagination.total=e.body.totalNum,t.adminUserLoading=!1}))},terminalSessionPaginationCurrentChange:function(t){this.terminalSessionPagination.currentPage=t,this.fetchTerminalSessionData()},fetchTerminalSessionData:function(){var t=this;this.terminalSessionLoading=!0;var e={page:this.terminalSessionPagination.currentPage,length:this.terminalSessionPagination.pageSize};b(e).then((function(e){t.terminalSessionTableData=e.body.data,t.terminalSessionPagination.total=e.body.totalNum,t.terminalSessionLoading=!1}))}})},x=y,k=(n("3a3b"),n("2877")),O=function(t){t.options.__source="src/pages/jump/jumpserver/settings/index.vue"},j=O,w=Object(k["a"])(x,s,a,!1,null,"35f5dd49",null);"function"===typeof j&&j(w);e["default"]=w.exports},"9f19":function(t,e,n){"use strict";n.d(e,"d",(function(){return a})),n.d(e,"g",(function(){return r})),n.d(e,"h",(function(){return i})),n.d(e,"f",(function(){return o})),n.d(e,"b",(function(){return l})),n.d(e,"c",(function(){return c})),n.d(e,"a",(function(){return u})),n.d(e,"e",(function(){return d}));var s=n("9bd2");function a(t){return Object(s["a"])({url:"/jump/jumpserver/user/page/fuzzy/query",method:"post",data:t})}function r(){return Object(s["a"])({url:"/jump/jumpserver/user/sync",method:"get"})}function i(t){return Object(s["a"])({url:"/jump/jumpserver/user/id/sync?id="+t,method:"get"})}function o(t){return Object(s["a"])({url:"/jump/jumpserver/user/active/set?id="+t,method:"get"})}function l(t){return Object(s["a"])({url:"/jump/jumpserver/user/del?username="+t,method:"delete"})}function c(t){return Object(s["a"])({url:"/jump/jumpserver/user/admin/page/fuzzy/query",method:"post",data:t})}function u(t){return Object(s["a"])({url:"/jump/jumpserver/user/admin/auth?id="+t,method:"get"})}function d(t){return Object(s["a"])({url:"/jump/jumpserver/user/admin/revoke?id="+t,method:"get"})}},da4f:function(t,e,n){"use strict";function s(t){switch(t){case"User":return"success";case"Auditor":return"warning";case"Admin":return"danger";default:return"info"}}function a(t){switch(t){case"User":return"用户";case"Auditor":return"审计员";case"Admin":return"管理员";default:return"未定义"}}n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return a}))}}]);